<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ø®Ø±ÛŒØ¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ (Smart Sourcing) | Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vazirmatn Font -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- React Dependencies (Production) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Vazirmatn', sans-serif; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Animation Utilities */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out forwards; }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #1e3a8a;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Shared Components (Header/Icon) ---
        const supabaseUrl = 'https://wehyjatotbzxargnxasg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlaHlqYXRvdGJ6eGFyZ254YXNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MTIwMjEsImV4cCI6MjA2NzQ4ODAyMX0.2R448DuEBlTrNvaYXiYZ8D5M7MJNv7n1qmIDHQBNFiY';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        const logoPath = "telegram-peer-photo-size-4-6021841146436766379-1-0-0.jpg";

        const Icon = ({ name, className }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (!window.lucide || !ref.current) return;
                const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                const iconDef = window.lucide.icons[pascalName];
                if (iconDef) {
                    const svg = window.lucide.createElement(iconDef);
                    if (className) className.split(' ').forEach(cls => { if(cls.trim()) svg.classList.add(cls); });
                    ref.current.innerHTML = '';
                    ref.current.appendChild(svg);
                }
            }, [name, className]);
            return <span ref={ref} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}></span>;
        };

        // --- Helper Functions ---
        const formatCurrency = (value) => value ? Number(value).toLocaleString('fa-IR') : 'Û°';
        const formatPercent = (value) => value ? Number(value).toLocaleString('fa-IR', { style: 'percent', minimumFractionDigits: 0 }) : 'Û°';
        
        const strategyDefaults = {
            'safe': { fast: 70, trend: 20, niche: 10 },
            'trend': { fast: 20, trend: 60, niche: 20 },
            'margin': { fast: 20, trend: 30, niche: 50 },
            'balanced': { fast: 40, trend: 30, niche: 30 },
        };

        // --- Mock Logic ---
        const generateMockResults = (budget, category, allocation) => {
            const categoryName = { 'speaker': 'Ø§Ø³Ù¾ÛŒÚ©Ø±', 'headphone': 'Ù‡Ø¯ÙÙˆÙ†', 'cable': 'Ú©Ø§Ø¨Ù„', 'kitchen': 'Ù„ÙˆØ§Ø²Ù… Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡' }[category] || 'Ú©Ø§Ù„Ø§';
            const results = {
                summary: {
                    totalBudget: budget,
                    fastAmount: budget * (allocation.fast / 100),
                    trendAmount: budget * (allocation.trend / 100),
                    nicheAmount: budget * (allocation.niche / 100),
                },
                products: [
                    { id: 1, name: `${categoryName} Ù…Ø¯Ù„ A (Ù¾Ø±ÙØ±ÙˆØ´)`, type: 'Ù¾Ø±ÙØ±ÙˆØ´', buyPrice: 2500000, demand: 950, margin: 0.08, growth: 0.05, competition: 'Ø²ÛŒØ§Ø¯', suggestion: 'Ø®Ø±ÛŒØ¯' },
                    { id: 2, name: `${categoryName} Ù…Ø¯Ù„ X (Ù¾Ø±ÙØ±ÙˆØ´)`, type: 'Ù¾Ø±ÙØ±ÙˆØ´', buyPrice: 1200000, demand: 1100, margin: 0.10, growth: 0.02, competition: 'Ø²ÛŒØ§Ø¯', suggestion: 'Ø®Ø±ÛŒØ¯' },
                    { id: 3, name: `${categoryName} Ù…Ø¯Ù„ B (ØªØ±ÛŒÙ†Ø¯ÛŒ)`, type: 'ØªØ±ÛŒÙ†Ø¯ÛŒ', buyPrice: 3000000, demand: 250, margin: 0.25, growth: 0.23, competition: 'Ù…ØªÙˆØ³Ø·', suggestion: 'Ø®Ø±ÛŒØ¯' },
                    { id: 4, name: `${categoryName} Ù…Ø¯Ù„ Y (ØªØ±ÛŒÙ†Ø¯ÛŒ)`, type: 'ØªØ±ÛŒÙ†Ø¯ÛŒ', buyPrice: 4500000, demand: 180, margin: 0.22, growth: 0.35, competition: 'Ù¾Ø§ÛŒÛŒÙ†', suggestion: 'Ø®Ø±ÛŒØ¯' },
                    { id: 5, name: `${categoryName} Ù…Ø¯Ù„ C (Ø®Ø§Øµ)`, type: 'Ø®Ø§Øµ', buyPrice: 4000000, demand: 70, margin: 0.35, growth: 0.12, competition: 'Ù¾Ø§ÛŒÛŒÙ†', suggestion: 'Ø¨Ø±Ø±Ø³ÛŒ' },
                ],
            };
            results.products = results.products.filter(p => (p.type === 'Ù¾Ø±ÙØ±ÙˆØ´' && allocation.fast > 0) || (p.type === 'ØªØ±ÛŒÙ†Ø¯ÛŒ' && allocation.trend > 0) || (p.type === 'Ø®Ø§Øµ' && allocation.niche > 0));
            return results;
        };

        // --- Main Component ---
        const SmartSourcingDashboard = () => {
            // Header States
            const [searchTerm, setSearchTerm] = useState('');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [showSupplierDropdown, setShowSupplierDropdown] = useState(false);
            const [mobileSupplierExpanded, setMobileSupplierExpanded] = useState(false);
            const [showSearchDropdown, setShowSearchDropdown] = useState(false);
            const searchContainerRef = useRef(null);
            const supplierDropdownRef = useRef(null);

            // App States
            const [step, setStep] = useState(1);
            const [isLoading, setIsLoading] = useState(false);
            const [budget, setBudget] = useState(50000000);
            const [category, setCategory] = useState('speaker');
            const [strategy, setStrategy] = useState('balanced');
            const [allocation, setAllocation] = useState(strategyDefaults.balanced);
            const [results, setResults] = useState({ summary: {}, products: [] });
            const [comparisonList, setComparisonList] = useState([]);

            // Effects
            useEffect(() => {
                const handleClickOutside = (e) => {
                    if (searchContainerRef.current && !searchContainerRef.current.contains(e.target)) setShowSearchDropdown(false);
                    if (supplierDropdownRef.current && !supplierDropdownRef.current.contains(e.target)) setShowSupplierDropdown(false);
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            // Handlers
            const handleToggleCompare = (productId) => setComparisonList(prev => prev.includes(productId) ? prev.filter(id => id !== productId) : [...prev, productId]);
            
            const handleStrategyChange = (e) => {
                setStrategy(e.target.value);
                setAllocation(strategyDefaults[e.target.value]);
            };

            const handleAllocationChange = (changedKey, val) => {
                let newValue = Math.min(100, Math.max(0, parseInt(val) || 0));
                const otherKeys = Object.keys(allocation).filter(k => k !== changedKey);
                let remaining = 100 - newValue;
                const oldTotal = otherKeys.reduce((s, k) => s + allocation[k], 0);
                
                let newAlloc = { ...allocation, [changedKey]: newValue };
                if (oldTotal === 0) {
                    otherKeys.forEach((k, i) => { const v = Math.round(remaining / (otherKeys.length - i)); newAlloc[k] = v; remaining -= v; });
                } else {
                    let dist = 0;
                    otherKeys.forEach((k, i) => { 
                        const v = (i === otherKeys.length - 1) ? remaining - dist : Math.round(remaining * (allocation[k] / oldTotal)); 
                        newAlloc[k] = v; dist += v; 
                    });
                }
                // Fix rounding
                const total = Object.values(newAlloc).reduce((a, b) => a + b, 0);
                newAlloc[otherKeys[0]] += (100 - total);
                setAllocation(newAlloc);
            };

            const runAnalysis = (e) => {
                e.preventDefault();
                setIsLoading(true);
                setTimeout(() => {
                    setResults(generateMockResults(budget, category, allocation));
                    setIsLoading(false);
                    setStep(2);
                }, 1500);
            };

            // --- Sub-Components ---
            const AllocationSlider = ({ label, name, value, colorClass, bgClass }) => (
                <div className="space-y-3">
                    <div className="flex justify-between items-center text-xs font-bold">
                        <label className="text-slate-600">{label}</label>
                        <span className={`px-2 py-1 rounded-lg ${bgClass} ${colorClass}`}>{value}%</span>
                    </div>
                    <input type="range" min="0" max="100" value={value} onChange={(e) => handleAllocationChange(name, e.target.value)} className="accent-blue-900" />
                    <div className="text-left text-[10px] font-black text-slate-400">{formatCurrency(budget * (value / 100))} Øª</div>
                </div>
            );

            const ResultRow = ({ product }) => (
                <tr className="hover:bg-slate-50 transition-colors border-b border-slate-50 last:border-0">
                    <td className="p-4 text-center"><input type="checkbox" className="w-4 h-4 rounded border-slate-300 accent-blue-900" checked={comparisonList.includes(product.id)} onChange={() => handleToggleCompare(product.id)} /></td>
                    <td className="p-4 text-xs font-bold text-slate-700">{product.name}</td>
                    <td className="p-4 text-center"><span className={`px-2 py-1 rounded-full text-[10px] font-black ${product.type === 'Ù¾Ø±ÙØ±ÙˆØ´' ? 'bg-blue-50 text-blue-700' : product.type === 'ØªØ±ÛŒÙ†Ø¯ÛŒ' ? 'bg-amber-50 text-amber-700' : 'bg-purple-50 text-purple-700'}`}>{product.type}</span></td>
                    <td className="p-4 text-xs font-mono text-slate-600">{formatCurrency(product.buyPrice)}</td>
                    <td className="p-4 text-xs font-mono text-slate-600">{formatCurrency(product.demand)}</td>
                    <td className="p-4 text-xs font-black text-emerald-600">{formatPercent(product.margin)}</td>
                    <td className="p-4 text-xs font-black text-blue-600">{formatPercent(product.growth)}</td>
                    <td className="p-4 text-[10px] font-bold text-slate-500">{product.competition}</td>
                    <td className="p-4 text-xs font-black text-emerald-700">{product.suggestion === 'Ø®Ø±ÛŒØ¯' ? 'âœ… Ø®Ø±ÛŒØ¯' : 'âš ï¸ Ø¨Ø±Ø±Ø³ÛŒ'}</td>
                </tr>
            );

            return (
                <div className="min-h-screen flex flex-col font-vazir bg-[#f8fafc]">
                    {/* Header */}
                    <header className="bg-white/95 backdrop-blur-md border-b border-slate-200 sticky top-0 z-[100] shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 h-16 md:h-20 flex items-center justify-between gap-4">
                            <div className="flex items-center gap-2 md:gap-3 shrink-0">
                                <button className="md:hidden p-2 -mr-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors" onClick={() => setMobileMenuOpen(true)}><Icon name="menu" className="w-6 h-6" /></button>
                                <a href="index.html" className="cursor-pointer flex items-center gap-2">
                                    <img src={logoPath} alt="Logo" className="w-9 h-9 md:w-12 md:h-12 rounded-lg md:rounded-xl shadow-md object-cover border border-slate-100" />
                                    <span className="text-lg md:text-2xl font-black text-blue-900 tracking-tighter">Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</span>
                                </a>
                            </div>
                            <div className="flex-1 max-w-xl hidden md:block relative" ref={searchContainerRef}>
                                <div className="flex w-full border border-slate-200 rounded-xl md:rounded-2xl overflow-hidden bg-slate-50 focus-within:border-blue-900 focus-within:bg-white transition-all shadow-inner text-right">
                                    <input type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." className="flex-1 bg-transparent px-3 md:px-5 py-2 md:py-3 outline-none text-xs md:text-sm font-bold text-slate-700 text-right" value={searchTerm} onFocus={() => setShowSearchDropdown(true)} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <button className="bg-blue-900 text-white px-4 md:px-6 py-2 md:py-3 transition-colors"><Icon name="search" className="w-4 h-4 md:w-5 md:h-5" /></button>
                                </div>
                            </div>
                            <div className="hidden md:flex items-center gap-6 shrink-0">
                                <a href="https://blog.bazaario.net/" className="text-xs font-black text-slate-600 hover:text-blue-900 transition-colors">Ù…Ø¬Ù„Ù‡ Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</a>
                                <a href="https://tools.bazaario.net/" className="flex items-center gap-2 text-xs font-black text-blue-900"><Icon name="wrench" className="w-4 h-4 text-emerald-600" /> Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</a>
                                <div className="relative" ref={supplierDropdownRef}>
                                    <button onClick={() => setShowSupplierDropdown(!showSupplierDropdown)} className="bg-blue-900 text-white px-5 py-2.5 rounded-xl font-black text-xs shadow-lg flex items-center gap-2 hover:bg-blue-800 transition-colors">
                                        Ù¾Ù†Ù„ ØªØ§Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† <Icon name="chevron-down" className={`w-3 h-3 transition-transform duration-200 ${showSupplierDropdown ? 'rotate-180' : ''}`} />
                                    </button>
                                    {showSupplierDropdown && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden z-[120] animate-fade-in-up">
                                            <div className="p-1">
                                                <a href="Smart_Sourcing_Engine.html" className="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-right group bg-orange-50/50">
                                                    <div className="bg-orange-50 text-orange-600 p-2.5 rounded-lg group-hover:bg-orange-100 transition-colors shrink-0"><Icon name="calculator" className="w-5 h-5" /></div>
                                                    <div className="flex-1 min-w-0"><div className="text-xs font-black text-slate-700 mb-0.5 group-hover:text-blue-900 transition-colors">Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ø®Ø±ÛŒØ¯</div><div className="text-[10px] text-slate-400 font-bold truncate">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª ØªÙ…Ø§Ù… Ø´Ø¯Ù‡</div></div>
                                                </a>
                                                <a href="demand_radar.html" className="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-right group">
                                                    <div className="bg-blue-50 text-blue-600 p-2.5 rounded-lg group-hover:bg-blue-100 transition-colors shrink-0"><Icon name="radar" className="w-5 h-5" /></div>
                                                    <div className="flex-1 min-w-0"><div className="text-xs font-black text-slate-700 mb-0.5 group-hover:text-blue-900 transition-colors">Ø±Ø§Ø¯Ø§Ø± Ø¨Ø§Ø²Ø§Ø±</div><div className="text-[10px] text-slate-400 font-bold truncate">Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ ØªÙ‚Ø§Ø¶Ø§</div></div>
                                                </a>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                        {/* Mobile Drawer (Simplified) */}
                        <div className={`fixed inset-0 z-[200] md:hidden transition-opacity duration-300 ${mobileMenuOpen ? 'opacity-100 visible' : 'opacity-0 invisible'}`}>
                            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={() => setMobileMenuOpen(false)}></div>
                            <div className={`absolute right-0 top-0 h-full w-[85%] max-w-sm bg-white shadow-2xl transition-transform duration-300 ease-out flex flex-col ${mobileMenuOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                                <div className="p-5 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                                    <div className="flex items-center gap-3"><span className="font-black text-blue-900">Ù…Ù†ÙˆÛŒ Ø¨Ø§Ø²Ø§Ø±</span></div>
                                    <button onClick={() => setMobileMenuOpen(false)} className="p-2 text-slate-400 hover:text-rose-500 transition-colors"><Icon name="x" className="w-6 h-6" /></button>
                                </div>
                                <div className="p-6"><a href="index.html" className="flex items-center gap-4 text-sm font-black text-slate-700 cursor-pointer p-3 rounded-2xl hover:bg-slate-50"><Icon name="home" className="text-blue-900 w-5 h-5" /> ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a></div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 max-w-5xl mx-auto px-4 py-10 w-full">
                        {/* Title */}
                        <div className="mb-10 text-right">
                            <h1 className="text-2xl md:text-3xl font-black text-blue-900 mb-2 flex items-center gap-3">
                                <div className="bg-orange-100 text-orange-600 p-2 rounded-xl"><Icon name="cpu" className="w-6 h-6" /></div>
                                Ù…Ù‡Ù†Ø¯Ø³ÛŒ Ø®Ø±ÛŒØ¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ (Smart Sourcing)
                            </h1>
                            <p className="text-sm font-bold text-slate-500 pr-14">Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨ÙˆØ¯Ø¬Ù‡ØŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±</p>
                        </div>

                        {isLoading && (
                            <div className="fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-[200]">
                                <div className="flex flex-col items-center">
                                    <Icon name="loader-2" className="w-12 h-12 text-blue-900 animate-spin mb-4" />
                                    <p className="text-sm font-black text-slate-600">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§Ø²Ø§Ø±...</p>
                                </div>
                            </div>
                        )}

                        {step === 1 && (
                            <form onSubmit={runAnalysis} className="space-y-8 animate-fade-in-up">
                                {/* Step 1 Card */}
                                <div className="bg-white p-6 md:p-8 rounded-[32px] shadow-sm border border-slate-200">
                                    <h2 className="text-lg font-black text-slate-800 mb-6 flex items-center gap-2 border-b border-slate-100 pb-4">
                                        <span className="bg-blue-100 text-blue-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">Û±</span>
                                        Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 mb-2">Ø¨ÙˆØ¯Ø¬Ù‡ Ú©Ù„ Ø®Ø±ÛŒØ¯ (ØªÙˆÙ…Ø§Ù†)</label>
                                            <input type="number" value={budget} onChange={(e) => setBudget(Number(e.target.value))} className="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 text-sm font-bold text-slate-800 focus:border-blue-500 focus:bg-white outline-none transition-all" required />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 mb-2">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ø§Ù„Ø§</label>
                                            <select value={category} onChange={(e) => setCategory(e.target.value)} className="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 text-sm font-bold text-slate-800 focus:border-blue-500 focus:bg-white outline-none transition-all cursor-pointer">
                                                <option value="speaker">Ø§Ø³Ù¾ÛŒÚ©Ø± Ùˆ ØµÙˆØªÛŒ</option>
                                                <option value="headphone">Ù‡Ø¯ÙÙˆÙ† Ùˆ Ù‡Ù†Ø¯Ø²ÙØ±ÛŒ</option>
                                                <option value="cable">Ú©Ø§Ø¨Ù„ Ùˆ Ø´Ø§Ø±Ú˜Ø±</option>
                                                <option value="kitchen">Ù„ÙˆØ§Ø²Ù… Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Step 2 Card */}
                                <div className="bg-white p-6 md:p-8 rounded-[32px] shadow-sm border border-slate-200">
                                    <h2 className="text-lg font-black text-slate-800 mb-6 flex items-center gap-2 border-b border-slate-100 pb-4">
                                        <span className="bg-blue-100 text-blue-700 w-6 h-6 rounded-full flex items-center justify-center text-xs">Û²</span>
                                        Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ùˆ ØªØ®ØµÛŒØµ
                                    </h2>
                                    <div className="mb-8">
                                        <label className="block text-xs font-bold text-slate-500 mb-2">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</label>
                                        <select value={strategy} onChange={handleStrategyChange} className="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 text-sm font-bold text-slate-800 focus:border-blue-500 outline-none transition-all cursor-pointer">
                                            <option value="balanced">âš–ï¸ ØªØ±Ú©ÛŒØ¨ÛŒ (Balanced Mix)</option>
                                            <option value="safe">ğŸ›¡ï¸ Ø§ÛŒÙ…Ù† (Safe Buy - ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ù¾Ø±ÙØ±ÙˆØ´)</option>
                                            <option value="trend">ğŸš€ Ù¾ÛŒØ´ØªØ§Ø² (Trend Catch - ØªÙ…Ø±Ú©Ø² Ø¨Ø± ØªØ±Ù†Ø¯)</option>
                                            <option value="margin">ğŸ’° Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± (High Margin - ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ø³ÙˆØ¯)</option>
                                        </select>
                                    </div>
                                    
                                    <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                            <AllocationSlider label="Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ù¾Ø±ÙØ±ÙˆØ´" name="fast" value={allocation.fast} colorClass="text-blue-700" bgClass="bg-blue-100" />
                                            <AllocationSlider label="Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ ØªØ±ÛŒÙ†Ø¯ÛŒ" name="trend" value={allocation.trend} colorClass="text-amber-700" bgClass="bg-amber-100" />
                                            <AllocationSlider label="Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ø®Ø§Øµ" name="niche" value={allocation.niche} colorClass="text-purple-700" bgClass="bg-purple-100" />
                                        </div>
                                        <div className="text-center mt-6 pt-4 border-t border-slate-200">
                                            <span className={`text-sm font-black ${allocation.fast + allocation.trend + allocation.niche === 100 ? 'text-emerald-600' : 'text-rose-500'}`}>Ù…Ø¬Ù…ÙˆØ¹: {allocation.fast + allocation.trend + allocation.niche}Ùª</span>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" disabled={(allocation.fast + allocation.trend + allocation.niche) !== 100} className="w-full bg-blue-900 hover:bg-blue-800 disabled:bg-slate-300 disabled:text-slate-500 text-white font-black py-4 rounded-2xl text-base shadow-xl shadow-blue-900/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                                    <Icon name="sparkles" className="w-5 h-5" />
                                    Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
                                </button>
                            </form>
                        )}

                        {step === 2 && (
                            <div className="animate-fade-in-up space-y-8">
                                <button onClick={() => { setStep(1); setComparisonList([]); }} className="text-xs font-bold text-slate-500 hover:text-blue-900 flex items-center gap-1 transition-colors">
                                    <Icon name="arrow-right" className="w-4 h-4" /> Ø¨Ø§Ø²Ú¯Ø´Øª Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´
                                </button>

                                {/* Summary Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div className="bg-slate-900 text-white p-6 rounded-3xl shadow-lg relative overflow-hidden">
                                        <div className="relative z-10">
                                            <div className="text-[10px] font-bold text-slate-400 mb-1">Ø¨ÙˆØ¯Ø¬Ù‡ Ú©Ù„</div>
                                            <div className="text-lg font-black">{formatCurrency(results.summary.totalBudget)} <span className="text-[10px]">Øª</span></div>
                                        </div>
                                        <Icon name="wallet" className="absolute bottom-[-10px] left-[-10px] w-20 h-20 text-white/5" />
                                    </div>
                                    <div className="bg-white p-5 rounded-3xl border border-slate-100 shadow-sm">
                                        <div className="text-[10px] font-bold text-slate-400 mb-1">Ù¾Ø±ÙØ±ÙˆØ´â€ŒÙ‡Ø§ ({allocation.fast}Ùª)</div>
                                        <div className="text-lg font-black text-blue-900">{formatCurrency(results.summary.fastAmount)} <span className="text-[10px]">Øª</span></div>
                                    </div>
                                    <div className="bg-white p-5 rounded-3xl border border-slate-100 shadow-sm">
                                        <div className="text-[10px] font-bold text-slate-400 mb-1">ØªØ±ÛŒÙ†Ø¯ÛŒâ€ŒÙ‡Ø§ ({allocation.trend}Ùª)</div>
                                        <div className="text-lg font-black text-amber-600">{formatCurrency(results.summary.trendAmount)} <span className="text-[10px]">Øª</span></div>
                                    </div>
                                    <div className="bg-white p-5 rounded-3xl border border-slate-100 shadow-sm">
                                        <div className="text-[10px] font-bold text-slate-400 mb-1">Ø®Ø§Øµ ({allocation.niche}Ùª)</div>
                                        <div className="text-lg font-black text-purple-600">{formatCurrency(results.summary.nicheAmount)} <span className="text-[10px]">Øª</span></div>
                                    </div>
                                </div>

                                {/* Table */}
                                <div className="bg-white rounded-[32px] shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                        <h2 className="font-black text-slate-800 flex items-center gap-2"><Icon name="list" className="w-5 h-5 text-blue-500" /> Ù„ÛŒØ³Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</h2>
                                        {comparisonList.length > 1 && (
                                            <button onClick={() => setStep(3)} className="bg-blue-50 text-blue-700 px-4 py-2 rounded-xl text-xs font-bold hover:bg-blue-100 transition-colors flex items-center gap-2">
                                                <Icon name="bar-chart-2" className="w-4 h-4" /> Ù…Ù‚Ø§ÛŒØ³Ù‡ ({comparisonList.length})
                                            </button>
                                        )}
                                    </div>
                                    <div className="overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-right min-w-[800px]">
                                            <thead className="bg-slate-50/50">
                                                <tr>
                                                    <th className="p-4 text-center w-12">#</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ù†Ø§Ù… Ú©Ø§Ù„Ø§</th>
                                                    <th className="p-4 text-center text-xs font-black text-slate-400">Ø¯Ø³ØªÙ‡</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">ØªÙ‚Ø§Ø¶Ø§ (Ù…Ø§Ù‡Ø§Ù†Ù‡)</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ù…Ø§Ø±Ú˜ÛŒÙ†</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ø±Ø´Ø¯</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ø±Ù‚Ø§Ø¨Øª</th>
                                                    <th className="p-4 text-xs font-black text-slate-400">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {results.products.length > 0 ? results.products.map(p => <ResultRow key={p.id} product={p} />) : <tr><td colSpan="9" className="p-8 text-center text-slate-400 text-xs font-bold">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {step === 3 && (
                            <div className="animate-fade-in-up">
                                <button onClick={() => setStep(2)} className="mb-6 text-xs font-bold text-slate-500 hover:text-blue-900 flex items-center gap-1 transition-colors"><Icon name="arrow-right" className="w-4 h-4" /> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                                <div className="bg-white rounded-[32px] shadow-lg border border-slate-200 overflow-hidden p-6">
                                    <h2 className="text-lg font-black text-slate-800 mb-6 flex items-center gap-2"><Icon name="git-compare" className="w-5 h-5 text-blue-500" /> Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ø§Ù„Ø§Ù‡Ø§</h2>
                                    <div className="overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-center">
                                            <thead>
                                                <tr>
                                                    <th className="p-4 text-right text-xs font-black text-slate-400">Ù…Ø´Ø®ØµÙ‡</th>
                                                    {results.products.filter(p => comparisonList.includes(p.id)).map(p => (
                                                        <th key={p.id} className="p-4 min-w-[150px]">
                                                            <div className="text-xs font-black text-slate-800 mb-1">{p.name}</div>
                                                            <button onClick={() => handleToggleCompare(p.id)} className="text-[9px] text-rose-500 hover:bg-rose-50 px-2 py-0.5 rounded transition-colors">Ø­Ø°Ù</button>
                                                        </th>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50 text-xs font-bold text-slate-600">
                                                <tr><td className="p-4 text-right font-black bg-slate-50/50">Ù‚ÛŒÙ…Øª</td>{results.products.filter(p => comparisonList.includes(p.id)).map(p => <td key={p.id} className="p-4">{formatCurrency(p.buyPrice)}</td>)}</tr>
                                                <tr><td className="p-4 text-right font-black bg-slate-50/50">ØªÙ‚Ø§Ø¶Ø§</td>{results.products.filter(p => comparisonList.includes(p.id)).map(p => <td key={p.id} className="p-4">{formatCurrency(p.demand)}</td>)}</tr>
                                                <tr><td className="p-4 text-right font-black bg-slate-50/50">Ø³ÙˆØ¯</td>{results.products.filter(p => comparisonList.includes(p.id)).map(p => <td key={p.id} className="p-4 text-emerald-600">{formatPercent(p.margin)}</td>)}</tr>
                                                <tr><td className="p-4 text-right font-black bg-slate-50/50">Ø±Ø´Ø¯</td>{results.products.filter(p => comparisonList.includes(p.id)).map(p => <td key={p.id} className="p-4 text-blue-600">{formatPercent(p.growth)}</td>)}</tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="bg-[#0f172a] py-12 md:py-20 text-white text-right relative overflow-hidden border-t border-white/5">
                        <div className="max-w-7xl mx-auto px-4 relative z-10">
                            <div className="grid grid-cols-1 md:grid-cols-12 gap-10 md:gap-16">
                                <div className="md:col-span-6 space-y-6">
                                    <div className="flex items-center gap-4">
                                        <img src={logoPath} className="w-10 h-10 md:w-12 md:h-12 rounded-xl object-cover" />
                                        <span className="text-2xl md:text-3xl font-black tracking-tighter">Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</span>
                                    </div>
                                    <p className="text-slate-400 text-sm md:text-lg leading-relaxed max-w-xl font-medium italic border-r-4 border-blue-600 pr-6">Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ Ø§ÙˆÙ„ÛŒÙ† Ù¾Ù„ØªÙØ±Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ£Ù…ÛŒÙ† Ø¯Ø± Ø§ÛŒØ±Ø§Ù† Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ø³Ø±Ø¹Øª Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ú©Ø§Ù„Ø§ØŒ Ø®ÙˆØ§Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø¯Ø± Ø§Ù†Ø¨Ø§Ø± Ø±Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                                </div>
                                <div className="md:col-span-6 grid grid-cols-2 gap-8">
                                    <div className="space-y-4">
                                        <h4 className="font-black text-blue-400 text-[10px] md:text-xs uppercase tracking-widest border-b border-white/10 pb-2">Ù¾Ù„ØªÙØ±Ù…</h4>
                                        <ul className="space-y-2 text-xs md:text-sm font-bold text-slate-500">
                                            <li><a href="#" className="hover:text-white transition-all">Ù…Ø¬Ù„Ù‡ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ</a></li>
                                            <li><a href="#" className="hover:text-white transition-all">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</a></li>
                                        </ul>
                                    </div>
                                    <div className="space-y-4">
                                        <h4 className="font-black text-emerald-400 text-[10px] md:text-xs uppercase tracking-widest border-b border-white/10 pb-2">Ø§Ø±ØªØ¨Ø§Ø·</h4>
                                        <ul className="space-y-3 text-xs md:text-sm font-bold text-slate-100">
                                            <li className="flex items-center gap-2 justify-end tracking-tighter">0903 671 2820 <Icon name="phone" className="w-3.5 h-3.5 text-emerald-400" /></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-12 pt-8 border-t border-white/5 text-center text-[8px] md:text-[10px] font-black text-slate-600 tracking-[0.4em] uppercase">Â© 2024 Bazaario | Smart Sourcing Module</div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SmartSourcingDashboard />);
    </script>
</body>
</html>