<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ (Demand Radar)</title>
    
    <!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ±Ù…ØªÙ† -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatan:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ React Ùˆ Recharts -->
    <!-- 1. React & ReactDOM -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <!-- 2. Babel (Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ JSX Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. PropTypes (Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Recharts Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ React 17) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    
    <!-- 4. Recharts (Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø±) - using cdnjs for stability -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>

    <style>
        body, .font-vazir {
            font-family: 'Vazirmatan', sans-serif;
        }
        /* Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ø¬Ù‡Øª LTR Ø¯Ø± Ù†Ù…ÙˆØ¯Ø§Ø± */
        .recharts-legend-wrapper {
            direction: rtl !important;
        }
        .recharts-default-tooltip {
            direction: rtl !important;
            font-family: 'Vazirmatan', sans-serif !important;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Ø§ÛŒÙ† div Ø±ÛŒØ´Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† React Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯ -->
    <div id="root"></div>

    <!-- 
      - Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
      - Ù†ÙˆØ¹ Ø¢Ù† 'text/babel' Ø§Ø³Øª ØªØ§ Babel Ø¢Ù† Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†Ø¯
    -->
    <script type="text/babel">
        // --- Ø§ÛŒÙ…Ù¾ÙˆØ±Øª Ú©Ø±Ø¯Ù† Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ø§Ø² Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Global ---
        // Ø§ÛŒÙ† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø¯Ø± <head> Ù„ÙˆØ¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
        const { useState, useEffect } = React;
        const { 
            LineChart, 
            Line, 
            XAxis, 
            YAxis, 
            CartesianGrid, 
            Tooltip, 
            Legend, 
            ResponsiveContainer 
        } = window.Recharts;

        // --- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (Mock Data) ---
        const MOCK_REGIONS = ['ØªÙ‡Ø±Ø§Ù†', 'Ø®ÙˆØ²Ø³ØªØ§Ù†', 'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ', 'ÙØ§Ø±Ø³', 'Ø§ØµÙÙ‡Ø§Ù†', 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ'];
        const MOCK_CATEGORIES = ['Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„', 'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ', 'Ù„ÙˆØ§Ø²Ù… Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡', 'Ø§Ø³Ù¾ÛŒÚ©Ø± Ùˆ ØµÙˆØªÛŒ'];

        const mockApiData = {
            current: {
                'ØªÙ‡Ø±Ø§Ù†': {
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„': { current_demand: 12500, fulfillment_rate: 0.85, avg_price: 1150000, competition_index: 8.2 },
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ': { current_demand: 8200, fulfillment_rate: 0.78, avg_price: 2500000, competition_index: 6.5 },
                    'Ù„ÙˆØ§Ø²Ù… Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡': { current_demand: 9500, fulfillment_rate: 0.90, avg_price: 3200000, competition_index: 7.1 },
                    'Ø§Ø³Ù¾ÛŒÚ©Ø± Ùˆ ØµÙˆØªÛŒ': { current_demand: 4300, fulfillment_rate: 0.82, avg_price: 1800000, competition_index: 9.0 },
                },
                'Ø®ÙˆØ²Ø³ØªØ§Ù†': {
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„': { current_demand: 7800, fulfillment_rate: 0.75, avg_price: 1100000, competition_index: 5.4 },
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ': { current_demand: 6100, fulfillment_rate: 0.65, avg_price: 2450000, competition_index: 4.1 },
                    'Ù„ÙˆØ§Ø²Ù… Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡': { current_demand: 5200, fulfillment_rate: 0.80, avg_price: 3100000, competition_index: 4.8 },
                    'Ø§Ø³Ù¾ÛŒÚ©Ø± Ùˆ ØµÙˆØªÛŒ': { current_demand: 3100, fulfillment_rate: 0.70, avg_price: 1750000, competition_index: 6.2 },
                },
            },
            trend: {
                'ØªÙ‡Ø±Ø§Ù†': {
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„': {
                        historical: [
                            { month: 'ÙØ±ÙˆØ±Ø¯ÛŒÙ†', volume: 8000 }, { month: 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', volume: 8200 }, { month: 'Ø®Ø±Ø¯Ø§Ø¯', volume: 9000 },
                            { month: 'ØªÛŒØ±', volume: 9500 }, { month: 'Ù…Ø±Ø¯Ø§Ø¯', volume: 11000 }, { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 12000 },
                        ],
                        forecast: [
                            { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 12000 },
                            { month: 'Ù…Ù‡Ø±', volume: 12800 }, { month: 'Ø¢Ø¨Ø§Ù†', volume: 13500 }, { month: 'Ø¢Ø°Ø±', volume: 14200 },
                        ]
                    },
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ': {
                        historical: [
                            { month: 'ÙØ±ÙˆØ±Ø¯ÛŒÙ†', volume: 6000 }, { month: 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', volume: 6100 }, { month: 'Ø®Ø±Ø¯Ø§Ø¯', volume: 6300 },
                            { month: 'ØªÛŒØ±', volume: 7000 }, { month: 'Ù…Ø±Ø¯Ø§Ø¯', volume: 7500 }, { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 8000 },
                        ],
                        forecast: [
                            { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 8000 },
                            { month: 'Ù…Ù‡Ø±', volume: 8300 }, { month: 'Ø¢Ø¨Ø§Ù†', volume: 8500 }, { month: 'Ø¢Ø°Ø±', volume: 8700 },
                        ]
                    }
                },
                'Ø®ÙˆØ²Ø³ØªØ§Ù†': {
                    'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„': {
                        historical: [
                            { month: 'ÙØ±ÙˆØ±Ø¯ÛŒÙ†', volume: 4500 }, { month: 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', volume: 4700 }, { month: 'Ø®Ø±Ø¯Ø§Ø¯', volume: 5000 },
                            { month: 'ØªÛŒØ±', volume: 5500 }, { month: 'Ù…Ø±Ø¯Ø§Ø¯', volume: 6200 }, { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 7500 },
                        ],
                        forecast: [
                            { month: 'Ø´Ù‡Ø±ÛŒÙˆØ±', volume: 7500 },
                            { month: 'Ù…Ù‡Ø±', volume: 7900 }, { month: 'Ø¢Ø¨Ø§Ù†', volume: 8200 }, { month: 'Ø¢Ø°Ø±', volume: 8500 },
                        ]
                    },
                }
            },
            heatmap: {
                'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„': [
                    { region: 'ØªÙ‡Ø±Ø§Ù†', growth: 15.2, gap: 0.15 },
                    { region: 'Ø®ÙˆØ²Ø³ØªØ§Ù†', growth: 22.5, gap: 0.30 },
                    { region: 'Ø§ØµÙÙ‡Ø§Ù†', growth: 18.0, gap: 0.20 },
                    { region: 'ÙØ§Ø±Ø³', growth: 16.8, gap: 0.25 },
                    { region: 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ', growth: 12.1, gap: 0.18 },
                    { region: 'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ', growth: 9.5, gap: 0.12 },
                ],
                'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ': [
                    { region: 'ØªÙ‡Ø±Ø§Ù†', growth: 10.1, gap: 0.22 },
                    { region: 'Ø®ÙˆØ²Ø³ØªØ§Ù†', growth: 19.3, gap: 0.35 },
                    { region: 'Ø§ØµÙÙ‡Ø§Ù†', growth: 14.5, gap: 0.20 },
                    { region: 'ÙØ§Ø±Ø³', growth: 15.0, gap: 0.28 },
                    { region: 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ', growth: 8.0, gap: 0.15 },
                    { region: 'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ', growth: 11.2, gap: 0.19 },
                ],
            },
            nationalData: {
                topCategories: [
                    { name: 'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„', growth: '+18.5%' },
                    { name: 'Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ø®ÙˆØ¯Ø±Ùˆ', growth: '+14.2%' },
                    { name: 'Ø§Ø¨Ø²Ø§Ø±Ø¢Ù„Ø§Øª Ø¨Ø±Ù‚ÛŒ', growth: '+9.1%' },
                ],
                opportunityRegions: [
                    { name: 'Ø®ÙˆØ²Ø³ØªØ§Ù†', gap: '35%', demand: 'Ø¨Ø§Ù„Ø§' },
                    { name: 'ÙØ§Ø±Ø³', gap: '28%', demand: 'Ù…ØªÙˆØ³Ø·' },
                    { name: 'Ø³ÛŒØ³ØªØ§Ù† Ùˆ Ø¨Ù„ÙˆÚ†Ø³ØªØ§Ù†', gap: '45%', demand: 'Ú©Ù… (Ø¯Ø± Ø­Ø§Ù„ Ø±Ø´Ø¯)' },
                ]
            }
        };

        // --- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªÙˆØ§Ø¨Ø¹ API ---
        const fetchCurrentDemand = (region, category) => {
            console.log(`Fetching current demand for: ${region}, ${category}`);
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(mockApiData.current[region]?.[category] || mockApiData.current['ØªÙ‡Ø±Ø§Ù†']['Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„']);
                }, 300);
            });
        };

        const fetchTrendData = (region, category) => {
            console.log(`Fetching trend data for: ${region}, ${category}`);
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(mockApiData.trend[region]?.[category] || mockApiData.trend['ØªÙ‡Ø±Ø§Ù†']['Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„']);
                }, 500);
            });
        };

        const fetchHeatmapData = (category) => {
            console.log(`Fetching heatmap data for: ${category}`);
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(mockApiData.heatmap[category] || mockApiData.heatmap['Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„']);
                }, 400);
            });
        };

        const fetchNationalData = () => {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(mockApiData.nationalData);
                }, 200);
            });
        };


        // --- Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ (Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø§Ù†Ù†Ø¯ ÙØ§ÛŒÙ„ jsx) ---

        // 1. Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø´Ø§Ø®Øµ (KPI)
        function KPICard({ title, value, unit, icon }) {
            return (
                <div className="bg-white p-6 rounded-lg shadow-md border-r-4 border-blue-500">
                    <div className="flex items-center justify-between">
                        <div>
                            <h3 className="text-sm font-medium text-gray-500 uppercase">{title}</h3>
                            <p className="text-3xl font-bold text-gray-900 mt-2">{value}</p>
                            {unit && <p className="text-sm text-gray-500">{unit}</p>}
                        </div>
                        {icon && <span className="text-4xl text-blue-300">{icon}</span>}
                    </div>
                </div>
            );
        }

        // 2. Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ (ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ)
        function DemandTrendChart({ data }) {
            if (!data || !data.historical || !data.forecast) {
                return <div className="text-center p-10">...</div>;
            }
            
            // Ø§Ø¯ØºØ§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡
            const chartData = [
                ...data.historical.map(d => ({ ...d, type: 'historical' })),
                ...data.forecast.slice(1).map(d => ({ ...d, type: 'forecast' })) // slice(1) Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù†Ù‚Ø·Ù‡ Ù…Ø´ØªØ±Ú©
            ];
            
            // Ù†Ù‚Ø·Ù‡ Ø§ØªØµØ§Ù„
            const connectionPoint = data.historical[data.historical.length - 1];
            const forecastData = [connectionPoint, ...data.forecast.slice(1)];


            return (
                <div className="bg-white p-6 rounded-lg shadow-md h-96">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ ØªÙ‚Ø§Ø¶Ø§ (ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ)</h3>
                    <ResponsiveContainer width="100%" height="100%" minHeight="300px">
                        <LineChart data={chartData} margin={{ top: 5, right: 20, left: -20, bottom: 5 }}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                            <XAxis dataKey="month" stroke="#6b7280" />
                            <YAxis 
                                stroke="#6b7280"
                                tickFormatter={(val) => val.toLocaleString('fa-IR')}
                            />
                            <Tooltip
                                formatter={(value) => [value.toLocaleString('fa-IR'), 'ØªØ¹Ø¯Ø§Ø¯']}
                            />
                            <Legend verticalAlign="top" height={36} />
                            
                            <Line
                                type="monotone"
                                dataKey="volume"
                                data={data.historical}
                                name="Ø±ÙˆÙ†Ø¯ ØªØ§Ø±ÛŒØ®ÛŒ"
                                stroke="#1d4ed8" // Blue
                                strokeWidth={3}
                                dot={false}
                            />
                            <Line
                                type="monotone"
                                dataKey="volume"
                                data={forecastData}
                                name="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ"
                                stroke="#22c55e" // Green
                                strokeWidth={3}
                                strokeDasharray="5 5"
                            />
                        </LineChart>
                    </ResponsiveContainer>
                </div>
            );
        }

        // 3. Ù†Ù‚Ø´Ù‡ Ø­Ø±Ø§Ø±ØªÛŒ (Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¬Ø¯ÙˆÙ„)
        function HeatmapTable({ data, category }) {
            
            const getGrowthColor = (growth) => {
                if (growth > 20) return 'bg-green-600 text-white';
                if (growth > 15) return 'bg-green-500 text-white';
                if (growth > 10) return 'bg-green-300 text-green-900';
                if (growth > 5) return 'bg-green-100 text-green-800';
                return 'bg-gray-100 text-gray-700';
            };

            const getGapColor = (gap) => {
                if (gap > 0.3) return 'bg-red-500 text-white';
                if (gap > 0.2) return 'bg-red-300 text-red-900';
                return 'bg-gray-100 text-gray-700';
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-md">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">
                        Ù†Ù‚Ø´Ù‡ Ø­Ø±Ø§Ø±ØªÛŒ ØªÙ‚Ø§Ø¶Ø§: <span className="text-blue-600">{category}</span>
                    </h3>
                    <div className="overflow-x-auto rounded-lg border border-gray-200">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-right text-xs font-bold text-gray-600 uppercase tracking-wider">Ø§Ø³ØªØ§Ù†</th>
                                    <th className="px-6 py-3 text-right text-xs font-bold text-gray-600 uppercase tracking-wider">Ù†Ø±Ø® Ø±Ø´Ø¯ (DGR)</th>
                                    <th className="px-6 py-3 text-right text-xs font-bold text-gray-600 uppercase tracking-wider">Ú¯Ù¾ Ø¹Ø±Ø¶Ù‡ (DFR Ù¾Ø§ÛŒÛŒÙ†)</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {data.map((item) => (
                                    <tr key={item.region}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{item.region}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                            <span className={`px-3 py-1 rounded-full font-semibold ${getGrowthColor(item.growth)}`}>
                                                {item.growth.toLocaleString('fa-IR')}%
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                            <span className={`px-3 py-1 rounded-full font-semibold ${getGapColor(item.gap)}`}>
                                                {(item.gap * 100).toLocaleString('fa-IR')}%
                                            </span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // 4. Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±ØªØ± (Ù…Ù„ÛŒ)
        function TopLists({ data }) {
            return (
                <div className="space-y-6">
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù„Ø§ÛŒÛŒ Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø±Ø´Ø¯</h3>
                        <ul className="space-y-3">
                            {data.topCategories.map(item => (
                                <li key={item.name} className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                    <span className="font-medium text-gray-800">{item.name}</span>
                                    <span className="text-sm font-bold text-green-600">{item.growth}</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4">Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ (Ú©Ù…Ø¨ÙˆØ¯ Ø¹Ø±Ø¶Ù‡)</h3>
                        <ul className="space-y-3">
                            {data.opportunityRegions.map(item => (
                                <li key={item.name} className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                    <span className="font-medium text-gray-800">{item.name}</span>
                                    <span className="text-sm font-bold text-red-600">Ú¯Ù¾: {item.gap}</span>
                                    <span className="text-sm text-gray-600">ØªÙ‚Ø§Ø¶Ø§: {item.demand}</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>
            );
        }

        // --- Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ (App) ---
        function App() {
            // State for filters
            const [selectedRegion, setSelectedRegion] = useState(MOCK_REGIONS[0]);
            const [selectedCategory, setSelectedCategory] = useState(MOCK_CATEGORIES[0]);
            const [view, setView] = useState('supplier'); // 'supplier' or 'national'
            
            // State for data
            const [currentData, setCurrentData] = useState(null);
            const [trendData, setTrendData] = useState(null);
            const [heatmapData, setHeatmapData] = useState([]);
            const [nationalData, setNationalData] = useState(null);
            const [loading, setLoading] = useState(true);

            // Data fetching effect
            useEffect(() => {
                const loadData = async () => {
                    setLoading(true);
                    try {
                        if (view === 'supplier') {
                            const [current, trend] = await Promise.all([
                                fetchCurrentDemand(selectedRegion, selectedCategory),
                                fetchTrendData(selectedRegion, selectedCategory)
                            ]);
                            setCurrentData(current);
                            setTrendData(trend);
                        } else { // 'national' view
                            const [heatmap, national] = await Promise.all([
                                fetchHeatmapData(selectedCategory),
                                fetchNationalData()
                            ]);
                            setHeatmapData(heatmap);
                            setNationalData(national);
                        }
                    } catch (error) {
                        console.error("Failed to load data:", error);
                        // TODO: Set error state
                    } finally {
                        setLoading(false);
                    }
                };

                loadData();
            }, [selectedRegion, selectedCategory, view]);

            // Helper to format numbers
            const formatPrice = (num) => num.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
            const formatPercent = (num) => (num * 100).toLocaleString('fa-IR', { maximumFractionDigits: 1 }) + '%';
            const formatNumber = (num) => num.toLocaleString('fa-IR');

            return (
                <div dir="rtl" className="bg-gray-100 min-h-screen p-4 md:p-8 font-vazir">
                    
                    {/* --- Ù‡Ø¯Ø± --- */}
                    <header className="mb-8">
                        <h1 className="text-3xl font-bold text-blue-800">ğŸ§­ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Demand Radar Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</h1>
                        <p className="text-lg text-gray-600 mt-1">ØªØ­Ù„ÛŒÙ„ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªÙ‚Ø§Ø¶Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù…Ú©Ø§Ù†</p>
                    </header>

                    {/* --- ÙÛŒÙ„ØªØ±Ù‡Ø§ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§ --- */}
                    <div className="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap items-center justify-between gap-4">
                        {/* View Toggler */}
                        <div className="flex bg-gray-200 rounded-lg p-1">
                            <button
                                onClick={() => setView('supplier')}
                                className={`px-4 py-2 text-sm font-semibold rounded-md ${view === 'supplier' ? 'bg-white shadow' : 'text-gray-600'}`}
                            >
                                Ù†Ù…Ø§ÛŒ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡
                            </button>
                            <button
                                onClick={() => setView('national')}
                                className={`px-4 py-2 text-sm font-semibold rounded-md ${view === 'national' ? 'bg-white shadow' : 'text-gray-600'}`}
                            >
                                Ù†Ù…Ø§ÛŒ Ù…Ù„ÛŒ (Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ)
                            </button>
                        </div>

                        {/* Filters */}
                        <div className="flex flex-wrap items-center gap-4">
                            {view === 'supplier' && (
                                <div className="flex items-center gap-2">
                                    <label htmlFor="region" className="text-sm font-medium text-gray-700">Ø§Ø³ØªØ§Ù†:</label>
                                    <select
                                        id="region"
                                        value={selectedRegion}
                                        onChange={(e) => setSelectedRegion(e.target.value)}
                                        className="block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                                    >
                                        {MOCK_REGIONS.map(r => <option key={r} value={r}>{r}</option>)}
                                    </select>
                                </div>
                            )}
                            <div className="flex items-center gap-2">
                                <label htmlFor="category" className="text-sm font-medium text-gray-700">Ø¯Ø³ØªÙ‡ Ú©Ø§Ù„Ø§:</label>
                                <select
                                    id="category"
                                    value={selectedCategory}
                                    onChange={(e) => setSelectedCategory(e.target.value)}
                                    className="block w-48 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                                >
                                    {MOCK_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* --- Ø¨Ø¯Ù†Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ --- */}
                    {loading ? (
                        <div className="text-center py-20 text-xl font-semibold text-gray-500">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...
                        </div>
                    ) : (
                        <>
                            {/* --- Ù†Ù…Ø§ÛŒ ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡ --- */}
                            {view === 'supplier' && currentData && trendData && (
                                <div className="space-y-6">
                                    {/* Row 1: KPIs */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        <KPICard title="ØªÙ‚Ø§Ø¶Ø§ÛŒ ÙØ¹Ù„ÛŒ (Ø¯Ø± Ø¨Ø§Ø²Ù‡)" value={formatNumber(currentData.current_demand)} unit="ÙˆØ§Ø­Ø¯" icon="ğŸ“Š" />
                                        <KPICard title="Ù†Ø±Ø® ØªØ­Ù‚Ù‚ ØªÙ‚Ø§Ø¶Ø§ (DFR)" value={formatPercent(currentData.fulfillment_rate)} unit="Ø§Ø² Ú©Ù„ ØªÙ‚Ø§Ø¶Ø§" icon="âœ…" />
                                        <KPICard title="Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚ÛŒÙ…Øª" value={formatPrice(currentData.avg_price)} icon="ğŸ’°" />
                                        <KPICard title="Ø´Ø§Ø®Øµ Ø±Ù‚Ø§Ø¨Øª" value={currentData.competition_index.toLocaleString('fa-IR')} unit="Ø§Ø² 10" icon="âš”ï¸" />
                                    </div>
                                    
                                    {/* Row 2: Trend Chart */}
                                    <DemandTrendChart data={trendData} />
                                </div>
                            )}

                            {/* --- Ù†Ù…Ø§ÛŒ Ù…Ù„ÛŒ --- */}
                            {view === 'national' && heatmapData && nationalData && (
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    {/* Column 1: Heatmap */}
                                    <div className="lg:col-span-2">
                                        <HeatmapTable data={heatmapData} category={selectedCategory} />
                                    </div>

                                    {/* Column 2: Top Lists */}
                                    <div className="lg:col-span-1">
                                        <TopLists data={nationalData} />
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    {/* --- ÙÙˆØªØ± --- */}
                    <footer className="mt-12 text-center text-gray-500 text-sm">
                        <p>Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù†Ø¯ Ø·Ø±Ø­ Ø¬Ø§Ù…Ø¹ Ù…Ø§Ú˜ÙˆÙ„ Demand Radar Ø¨Ø§Ø²Ø§Ø±ÛŒÙˆ</p>
                    </footer>
                </div>
            );
        }

        // --- Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯Ø± DOM ---
        ReactDOM.render(<App />, document.getElementById('root'));

    </script>

</body>
</html>