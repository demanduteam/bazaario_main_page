<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رادار بازار (Demand Radar) | بازاریو</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vazirmatn Font -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Supabase SDK (For Header Consistency) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- React Dependencies (Production build to suppress development warnings like defaultProps) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- PropTypes (Required for Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>

    <style>
        body { font-family: 'Vazirmatn', sans-serif; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        .market-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animation Utilities */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out forwards; }
        
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-down { animation: fadeInDown 0.3s ease-out forwards; }

        /* Recharts Overrides */
        .recharts-legend-wrapper { direction: rtl !important; }
        .recharts-default-tooltip { direction: rtl !important; font-family: 'Vazirmatn', sans-serif !important; border-radius: 12px !important; border: none !important; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important; }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts || {};

        // --- Safe Icon Component for Lucide + React ---
        const Icon = ({ name, className }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (!window.lucide || !ref.current) return;
                
                // Convert kebab-case (e.g. 'bar-chart-2') to PascalCase (e.g. 'BarChart2')
                const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                
                const iconDef = window.lucide.icons[pascalName];
                
                if (iconDef) {
                    const svg = window.lucide.createElement(iconDef);
                    
                    // Add classes to the SVG itself
                    if (className) {
                        className.split(' ').forEach(cls => {
                            if(cls.trim()) svg.classList.add(cls);
                        });
                    }
                    
                    // Clear previous content and append new SVG
                    ref.current.innerHTML = '';
                    ref.current.appendChild(svg);
                } else {
                    console.warn(`Icon "${name}" not found in Lucide.`);
                }
            }, [name, className]);

            // Using a span wrapper so React controls the wrapper, and we mess with the insides
            return <span ref={ref} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}></span>;
        };

        // --- Mock Data & Logic from original file ---
        const MOCK_REGIONS = ['تهران', 'خوزستان', 'آذربایجان شرقی', 'فارس', 'اصفهان', 'خراسان رضوی'];
        const MOCK_CATEGORIES = ['لوازم جانبی موبایل', 'لوازم جانبی خودرو', 'لوازم آشپزخانه', 'اسپیکر و صوتی'];

        const mockApiData = {
            current: {
                'تهران': { 'لوازم جانبی موبایل': { current_demand: 12500, fulfillment_rate: 0.85, avg_price: 1150000, competition_index: 8.2 }, 'لوازم جانبی خودرو': { current_demand: 8200, fulfillment_rate: 0.78, avg_price: 2500000, competition_index: 6.5 }, 'لوازم آشپزخانه': { current_demand: 9500, fulfillment_rate: 0.90, avg_price: 3200000, competition_index: 7.1 }, 'اسپیکر و صوتی': { current_demand: 4300, fulfillment_rate: 0.82, avg_price: 1800000, competition_index: 9.0 } },
                'خوزستان': { 'لوازم جانبی موبایل': { current_demand: 7800, fulfillment_rate: 0.75, avg_price: 1100000, competition_index: 5.4 }, 'لوازم جانبی خودرو': { current_demand: 6100, fulfillment_rate: 0.65, avg_price: 2450000, competition_index: 4.1 }, 'لوازم آشپزخانه': { current_demand: 5200, fulfillment_rate: 0.80, avg_price: 3100000, competition_index: 4.8 }, 'اسپیکر و صوتی': { current_demand: 3100, fulfillment_rate: 0.70, avg_price: 1750000, competition_index: 6.2 } },
            },
            trend: {
                'تهران': {
                    'لوازم جانبی موبایل': { historical: [{ month: 'فروردین', volume: 8000 }, { month: 'اردیبهشت', volume: 8200 }, { month: 'خرداد', volume: 9000 }, { month: 'تیر', volume: 9500 }, { month: 'مرداد', volume: 11000 }, { month: 'شهریور', volume: 12000 }], forecast: [{ month: 'شهریور', volume: 12000 }, { month: 'مهر', volume: 12800 }, { month: 'آبان', volume: 13500 }, { month: 'آذر', volume: 14200 }] },
                    'لوازم جانبی خودرو': { historical: [{ month: 'فروردین', volume: 6000 }, { month: 'اردیبهشت', volume: 6100 }, { month: 'خرداد', volume: 6300 }, { month: 'تیر', volume: 7000 }, { month: 'مرداد', volume: 7500 }, { month: 'شهریور', volume: 8000 }], forecast: [{ month: 'شهریور', volume: 8000 }, { month: 'مهر', volume: 8300 }, { month: 'آبان', volume: 8500 }, { month: 'آذر', volume: 8700 }] }
                },
                'خوزستان': {
                    'لوازم جانبی موبایل': { historical: [{ month: 'فروردین', volume: 4500 }, { month: 'اردیبهشت', volume: 4700 }, { month: 'خرداد', volume: 5000 }, { month: 'تیر', volume: 5500 }, { month: 'مرداد', volume: 6200 }, { month: 'شهریور', volume: 7500 }], forecast: [{ month: 'شهریور', volume: 7500 }, { month: 'مهر', volume: 7900 }, { month: 'آبان', volume: 8200 }, { month: 'آذر', volume: 8500 }] },
                }
            },
            heatmap: {
                'لوازم جانبی موبایل': [{ region: 'تهران', growth: 15.2, gap: 0.15 }, { region: 'خوزستان', growth: 22.5, gap: 0.30 }, { region: 'اصفهان', growth: 18.0, gap: 0.20 }, { region: 'فارس', growth: 16.8, gap: 0.25 }, { region: 'خراسان رضوی', growth: 12.1, gap: 0.18 }, { region: 'آذربایجان شرقی', growth: 9.5, gap: 0.12 }],
                'لوازم جانبی خودرو': [{ region: 'تهران', growth: 10.1, gap: 0.22 }, { region: 'خوزستان', growth: 19.3, gap: 0.35 }, { region: 'اصفهان', growth: 14.5, gap: 0.20 }, { region: 'فارس', growth: 15.0, gap: 0.28 }, { region: 'خراسان رضوی', growth: 8.0, gap: 0.15 }, { region: 'آذربایجان شرقی', growth: 11.2, gap: 0.19 }],
            },
            nationalData: {
                topCategories: [{ name: 'لوازم جانبی موبایل', growth: '+18.5%' }, { name: 'لوازم جانبی خودرو', growth: '+14.2%' }, { name: 'ابزارآلات برقی', growth: '+9.1%' }],
                opportunityRegions: [{ name: 'خوزستان', gap: '35%', demand: 'بالا' }, { name: 'فارس', gap: '28%', demand: 'متوسط' }, { name: 'سیستان و بلوچستان', gap: '45%', demand: 'کم (در حال رشد)' }]
            }
        };

        const fetchCurrentDemand = (region, category) => new Promise(resolve => setTimeout(() => resolve(mockApiData.current[region]?.[category] || mockApiData.current['تهران']['لوازم جانبی موبایل']), 300));
        const fetchTrendData = (region, category) => new Promise(resolve => setTimeout(() => resolve(mockApiData.trend[region]?.[category] || mockApiData.trend['تهران']['لوازم جانبی موبایل']), 500));
        const fetchHeatmapData = (category) => new Promise(resolve => setTimeout(() => resolve(mockApiData.heatmap[category] || mockApiData.heatmap['لوازم جانبی موبایل']), 400));
        const fetchNationalData = () => new Promise(resolve => setTimeout(() => resolve(mockApiData.nationalData), 200));

        // --- Shared Header & Footer Components (From Index) ---
        const supabaseUrl = 'https://wehyjatotbzxargnxasg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlaHlqYXRvdGJ6eGFyZ254YXNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MTIwMjEsImV4cCI6MjA2NzQ4ODAyMX0.2R448DuEBlTrNvaYXiYZ8D5M7MJNv7n1qmIDHQBNFiY';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        const logoPath = "telegram-peer-photo-size-4-6021841146436766379-1-0-0.jpg";

        // --- Styled Radar Components ---

        const KPICard = ({ title, value, unit, icon }) => (
            <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-md transition-all group">
                <div className="flex items-center justify-between mb-4">
                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-wider">{title}</h3>
                    <div className="w-10 h-10 rounded-2xl bg-slate-50 flex items-center justify-center text-blue-900 group-hover:bg-blue-50 transition-colors">
                        {icon}
                    </div>
                </div>
                <div className="flex items-baseline gap-1">
                    <p className="text-2xl font-black text-slate-800">{value}</p>
                    {unit && <p className="text-[10px] font-bold text-slate-400">{unit}</p>}
                </div>
            </div>
        );

        const DemandTrendChart = ({ data }) => {
            if (!data || !data.historical || !data.forecast) return <div className="p-10 text-center text-slate-400 font-bold">در حال بارگذاری نمودار...</div>;
            
            // Check if Recharts loaded correctly
            if (!LineChart || !Line || !XAxis || !YAxis || !CartesianGrid || !Tooltip || !Legend || !ResponsiveContainer) {
                return <div className="p-10 text-center text-rose-500 font-bold">خطا در بارگذاری کتابخانه نمودار</div>;
            }

            const chartData = [
                ...data.historical.map(d => ({ ...d, type: 'historical' })),
                ...data.forecast.slice(1).map(d => ({ ...d, type: 'forecast' }))
            ];
            const connectionPoint = data.historical[data.historical.length - 1];
            const forecastData = [connectionPoint, ...data.forecast.slice(1)];

            return (
                <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm h-96">
                    <h3 className="text-sm font-black text-slate-800 mb-6 flex items-center gap-2">
                        <Icon name="trending-up" className="w-4 h-4 text-emerald-500" />
                        نمودار روند تقاضا (تاریخی و پیش‌بینی)
                    </h3>
                    <ResponsiveContainer width="100%" height="85%">
                        <LineChart data={chartData} margin={{ top: 5, right: 10, left: -20, bottom: 0 }}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#f1f5f9" vertical={false} />
                            <XAxis dataKey="month" stroke="#94a3b8" tick={{fontSize: 10, fontFamily: 'Vazirmatn', fontWeight: 'bold'}} axisLine={false} tickLine={false} dy={10} />
                            <YAxis stroke="#94a3b8" tickFormatter={(val) => val.toLocaleString('fa-IR')} tick={{fontSize: 10, fontFamily: 'Vazirmatn', fontWeight: 'bold'}} axisLine={false} tickLine={false} dx={-10} />
                            <Tooltip contentStyle={{ borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)' }} formatter={(value) => [value.toLocaleString('fa-IR'), 'تعداد']} />
                            <Legend verticalAlign="top" height={36} iconType="circle" />
                            <Line type="monotone" dataKey="volume" data={data.historical} name="روند تاریخی" stroke="#1e3a8a" strokeWidth={3} dot={{r: 4, fill: '#1e3a8a', strokeWidth: 0}} activeDot={{r: 6}} />
                            <Line type="monotone" dataKey="volume" data={forecastData} name="پیش‌بینی" stroke="#10b981" strokeWidth={3} strokeDasharray="5 5" dot={false} activeDot={{r: 6}} />
                        </LineChart>
                    </ResponsiveContainer>
                </div>
            );
        };

        const HeatmapTable = ({ data, category }) => {
            const getGrowthColor = (growth) => {
                if (growth > 20) return 'bg-emerald-100 text-emerald-700';
                if (growth > 15) return 'bg-emerald-50 text-emerald-600';
                if (growth > 10) return 'bg-blue-50 text-blue-700';
                return 'bg-slate-100 text-slate-600';
            };
            const getGapColor = (gap) => {
                if (gap > 0.3) return 'bg-rose-100 text-rose-700';
                if (gap > 0.2) return 'bg-orange-50 text-orange-600';
                return 'bg-slate-100 text-slate-600';
            };

            return (
                <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                    <h3 className="text-sm font-black text-slate-800 mb-6 flex items-center gap-2">
                        <Icon name="map" className="w-4 h-4 text-blue-500" />
                        نقشه حرارتی تقاضا: <span className="text-blue-600">{category}</span>
                    </h3>
                    <div className="overflow-x-auto custom-scrollbar pb-2">
                        <table className="min-w-full">
                            <thead>
                                <tr className="border-b border-slate-100">
                                    <th className="px-4 py-3 text-right text-[10px] font-black text-slate-400 uppercase tracking-wider">استان</th>
                                    <th className="px-4 py-3 text-right text-[10px] font-black text-slate-400 uppercase tracking-wider">نرخ رشد (DGR)</th>
                                    <th className="px-4 py-3 text-right text-[10px] font-black text-slate-400 uppercase tracking-wider">گپ عرضه</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-50">
                                {data.map((item) => (
                                    <tr key={item.region} className="hover:bg-slate-50/50 transition-colors">
                                        <td className="px-4 py-4 whitespace-nowrap text-xs font-bold text-slate-700">{item.region}</td>
                                        <td className="px-4 py-4 whitespace-nowrap"><span className={`px-3 py-1 rounded-full text-[10px] font-black ${getGrowthColor(item.growth)}`}>{item.growth.toLocaleString('fa-IR')}%</span></td>
                                        <td className="px-4 py-4 whitespace-nowrap"><span className={`px-3 py-1 rounded-full text-[10px] font-black ${getGapColor(item.gap)}`}>{(item.gap * 100).toLocaleString('fa-IR')}%</span></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const TopLists = ({ data }) => (
            <div className="space-y-6">
                <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                    <h3 className="text-sm font-black text-slate-800 mb-4 flex items-center gap-2"><Icon name="trending-up" className="w-4 h-4 text-emerald-500" /> بیشترین رشد تقاضا</h3>
                    <ul className="space-y-3">
                        {data.topCategories.map(item => (
                            <li key={item.name} className="flex justify-between items-center p-3 bg-slate-50 rounded-2xl hover:bg-slate-100 transition-colors">
                                <span className="text-xs font-bold text-slate-700">{item.name}</span>
                                <span className="text-xs font-black text-emerald-600">{item.growth}</span>
                            </li>
                        ))}
                    </ul>
                </div>
                <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                    <h3 className="text-sm font-black text-slate-800 mb-4 flex items-center gap-2"><Icon name="alert-circle" className="w-4 h-4 text-rose-500" /> پتانسیل (کمبود عرضه)</h3>
                    <ul className="space-y-3">
                        {data.opportunityRegions.map(item => (
                            <li key={item.name} className="flex flex-col gap-1 p-3 bg-slate-50 rounded-2xl hover:bg-slate-100 transition-colors">
                                <div className="flex justify-between items-center">
                                    <span className="text-xs font-bold text-slate-700">{item.name}</span>
                                    <span className="text-[10px] font-black text-rose-500 bg-rose-50 px-2 py-0.5 rounded-lg">گپ: {item.gap}</span>
                                </div>
                                <span className="text-[10px] text-slate-400 font-bold">وضعیت تقاضا: {item.demand}</span>
                            </li>
                        ))}
                    </ul>
                </div>
            </div>
        );

        // --- Main App Component ---
        const App = () => {
            // Header Logic
            const [searchTerm, setSearchTerm] = useState('');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [showSupplierDropdown, setShowSupplierDropdown] = useState(false);
            const [mobileSupplierExpanded, setMobileSupplierExpanded] = useState(false);
            const [products, setProducts] = useState([]); // Simplified for UI
            const [showSearchDropdown, setShowSearchDropdown] = useState(false);
            const searchContainerRef = useRef(null);
            const supplierDropdownRef = useRef(null);

            // Dashboard Logic
            const [selectedRegion, setSelectedRegion] = useState(MOCK_REGIONS[0]);
            const [selectedCategory, setSelectedCategory] = useState(MOCK_CATEGORIES[0]);
            const [view, setView] = useState('supplier');
            const [currentData, setCurrentData] = useState(null);
            const [trendData, setTrendData] = useState(null);
            const [heatmapData, setHeatmapData] = useState([]);
            const [nationalData, setNationalData] = useState(null);
            const [loadingData, setLoadingData] = useState(true);

            useEffect(() => {
                const handleClickOutside = (e) => {
                    if (searchContainerRef.current && !searchContainerRef.current.contains(e.target)) setShowSearchDropdown(false);
                    if (supplierDropdownRef.current && !supplierDropdownRef.current.contains(e.target)) setShowSupplierDropdown(false);
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            useEffect(() => {
                const loadData = async () => {
                    setLoadingData(true);
                    try {
                        if (view === 'supplier') {
                            const [current, trend] = await Promise.all([fetchCurrentDemand(selectedRegion, selectedCategory), fetchTrendData(selectedRegion, selectedCategory)]);
                            setCurrentData(current);
                            setTrendData(trend);
                        } else {
                            const [heatmap, national] = await Promise.all([fetchHeatmapData(selectedCategory), fetchNationalData()]);
                            setHeatmapData(heatmap);
                            setNationalData(national);
                        }
                    } catch (error) { console.error(error); } finally { setLoadingData(false); }
                };
                loadData();
            }, [selectedRegion, selectedCategory, view]);

            const formatPrice = (num) => num.toLocaleString('fa-IR') + ' تومان';
            const formatPercent = (num) => (num * 100).toLocaleString('fa-IR', { maximumFractionDigits: 1 }) + '%';
            const formatNumber = (num) => num.toLocaleString('fa-IR');

            return (
                <div className="min-h-screen flex flex-col font-vazir">
                    {/* Header (From Index) */}
                    <header className="bg-white/95 backdrop-blur-md border-b border-slate-200 sticky top-0 z-[100] shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 h-16 md:h-20 flex items-center justify-between gap-4">
                            <div className="flex items-center gap-2 md:gap-3 shrink-0">
                                <button className="md:hidden p-2 -mr-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors" onClick={() => setMobileMenuOpen(true)}>
                                    <Icon name="menu" className="w-6 h-6" />
                                </button>
                                <a href="index.html" className="cursor-pointer flex items-center gap-2">
                                    <img src={logoPath} alt="Logo" className="w-9 h-9 md:w-12 md:h-12 rounded-lg md:rounded-xl shadow-md object-cover border border-slate-100" />
                                    <span className="text-lg md:text-2xl font-black text-blue-900 tracking-tighter">بازاریو</span>
                                </a>
                            </div>

                            <div className="flex-1 max-w-xl hidden md:block relative" ref={searchContainerRef}>
                                <div className="flex w-full border border-slate-200 rounded-xl md:rounded-2xl overflow-hidden bg-slate-50 focus-within:border-blue-900 focus-within:bg-white transition-all shadow-inner text-right">
                                    <input type="text" placeholder="جستجو..." className="flex-1 bg-transparent px-3 md:px-5 py-2 md:py-3 outline-none text-xs md:text-sm font-bold text-slate-700 text-right" value={searchTerm} onFocus={() => setShowSearchDropdown(true)} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <button className="bg-blue-900 text-white px-4 md:px-6 py-2 md:py-3 transition-colors"><Icon name="search" className="w-4 h-4 md:w-5 md:h-5" /></button>
                                </div>
                            </div>

                            <div className="hidden md:flex items-center gap-6 shrink-0">
                                <a href="https://blog.bazaario.net/" className="text-xs font-black text-slate-600 hover:text-blue-900 transition-colors">مجله بازاریو</a>
                                <a href="https://tools.bazaario.net/" className="flex items-center gap-2 text-xs font-black text-blue-900"><Icon name="wrench" className="w-4 h-4 text-emerald-600" /> ابزارها</a>
                                <div className="relative" ref={supplierDropdownRef}>
                                    <button onClick={() => setShowSupplierDropdown(!showSupplierDropdown)} className="bg-blue-900 text-white px-5 py-2.5 rounded-xl font-black text-xs shadow-lg flex items-center gap-2 hover:bg-blue-800 transition-colors">
                                        پنل تامین‌کنندگان <Icon name="chevron-down" className={`w-3 h-3 transition-transform duration-200 ${showSupplierDropdown ? 'rotate-180' : ''}`} />
                                    </button>
                                    {showSupplierDropdown && (
                                        <div className="absolute top-full left-0 mt-2 w-64 bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden z-[120] animate-fade-in-up">
                                            <div className="p-1">
                                                <a href="Smart_Sourcing_Engine.html" className="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-right group">
                                                    <div className="bg-orange-50 text-orange-600 p-2.5 rounded-lg group-hover:bg-orange-100 transition-colors shrink-0"><Icon name="calculator" className="w-5 h-5" /></div>
                                                    <div className="flex-1 min-w-0"><div className="text-xs font-black text-slate-700 mb-0.5 group-hover:text-blue-900 transition-colors">مهندسی خرید</div><div className="text-[10px] text-slate-400 font-bold truncate">محاسبه قیمت تمام شده</div></div>
                                                </a>
                                                <a href="demand_radar.html" className="flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-right group bg-blue-50/50">
                                                    <div className="bg-blue-50 text-blue-600 p-2.5 rounded-lg group-hover:bg-blue-100 transition-colors shrink-0"><Icon name="radar" className="w-5 h-5" /></div>
                                                    <div className="flex-1 min-w-0"><div className="text-xs font-black text-slate-700 mb-0.5 group-hover:text-blue-900 transition-colors">رادار بازار</div><div className="text-[10px] text-slate-400 font-bold truncate">شناسایی تقاضا</div></div>
                                                </a>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                        {/* Mobile Drawer (Simplified) */}
                        <div className={`fixed inset-0 z-[200] md:hidden transition-opacity duration-300 ${mobileMenuOpen ? 'opacity-100 visible' : 'opacity-0 invisible'}`}>
                            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={() => setMobileMenuOpen(false)}></div>
                            <div className={`absolute right-0 top-0 h-full w-[85%] max-w-sm bg-white shadow-2xl transition-transform duration-300 ease-out flex flex-col ${mobileMenuOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                                <div className="p-5 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                                    <div className="flex items-center gap-3"><span className="font-black text-blue-900">منوی بازار</span></div>
                                    <button onClick={() => setMobileMenuOpen(false)} className="p-2 text-slate-400 hover:text-rose-500 transition-colors"><Icon name="x" className="w-6 h-6" /></button>
                                </div>
                                <div className="p-6"><a href="index.html" className="flex items-center gap-4 text-sm font-black text-slate-700 cursor-pointer p-3 rounded-2xl hover:bg-slate-50"><Icon name="home" className="text-blue-900 w-5 h-5" /> صفحه اصلی</a></div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 max-w-7xl mx-auto px-4 py-8 w-full">
                        <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-10">
                            <div>
                                <h1 className="text-2xl md:text-3xl font-black text-blue-900 mb-2 flex items-center gap-3">
                                    <div className="relative flex h-4 w-4">
                                      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                      <span className="relative inline-flex rounded-full h-4 w-4 bg-blue-500"></span>
                                    </div>
                                    رادار بازار (Demand Radar)
                                </h1>
                                <p className="text-sm font-bold text-slate-500">تحلیل هوشمند و پیش‌بینی تقاضای بازار مبتنی بر مکان</p>
                            </div>
                            
                            {/* Controls */}
                            <div className="w-full md:w-auto flex flex-col sm:flex-row gap-4">
                                <div className="bg-slate-100 p-1.5 rounded-2xl flex relative">
                                    <button onClick={() => setView('supplier')} className={`px-4 py-2 text-xs font-black rounded-xl transition-all ${view === 'supplier' ? 'bg-white shadow-sm text-blue-900' : 'text-slate-500 hover:text-slate-700'}`}>نمای تأمین‌کننده</button>
                                    <button onClick={() => setView('national')} className={`px-4 py-2 text-xs font-black rounded-xl transition-all ${view === 'national' ? 'bg-white shadow-sm text-blue-900' : 'text-slate-500 hover:text-slate-700'}`}>نمای ملی (بازاریو)</button>
                                </div>
                                <div className="flex gap-2">
                                    {view === 'supplier' && (
                                        <select value={selectedRegion} onChange={(e) => setSelectedRegion(e.target.value)} className="bg-white border border-slate-200 text-slate-700 text-xs font-bold rounded-2xl px-4 py-3 outline-none focus:border-blue-500 shadow-sm">
                                            {MOCK_REGIONS.map(r => <option key={r} value={r}>{r}</option>)}
                                        </select>
                                    )}
                                    <select value={selectedCategory} onChange={(e) => setSelectedCategory(e.target.value)} className="bg-white border border-slate-200 text-slate-700 text-xs font-bold rounded-2xl px-4 py-3 outline-none focus:border-blue-500 shadow-sm">
                                        {MOCK_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                    </select>
                                </div>
                            </div>
                        </div>

                        {loadingData ? (
                            <div className="flex flex-col items-center justify-center py-32 opacity-50">
                                <Icon name="loader-2" className="w-10 h-10 text-blue-900 animate-spin mb-4" />
                                <span className="text-sm font-black text-slate-400">در حال دریافت سیگنال‌های بازار...</span>
                            </div>
                        ) : (
                            <div className="animate-fade-in-up">
                                {view === 'supplier' && currentData && trendData && (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <KPICard title="تقاضای فعلی" value={formatNumber(currentData.current_demand)} unit="واحد" icon={<Icon name="bar-chart-2" className="w-6 h-6" />} />
                                            <KPICard title="نرخ تحقق (DFR)" value={formatPercent(currentData.fulfillment_rate)} unit="از کل" icon={<Icon name="check-circle" className="w-6 h-6" />} />
                                            <KPICard title="میانگین قیمت" value={formatPrice(currentData.avg_price)} icon={<Icon name="dollar-sign" className="w-6 h-6" />} />
                                            <KPICard title="شاخص رقابت" value={currentData.competition_index.toLocaleString('fa-IR')} unit="از ۱۰" icon={<Icon name="users" className="w-6 h-6" />} />
                                        </div>
                                        <DemandTrendChart data={trendData} />
                                    </div>
                                )}

                                {view === 'national' && heatmapData && nationalData && (
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                        <div className="lg:col-span-2"><HeatmapTable data={heatmapData} category={selectedCategory} /></div>
                                        <div className="lg:col-span-1"><TopLists data={nationalData} /></div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Footer (From Index) */}
                    <footer className="bg-[#0f172a] py-12 md:py-20 text-white text-right relative overflow-hidden border-t border-white/5">
                        <div className="max-w-7xl mx-auto px-4 relative z-10">
                            <div className="grid grid-cols-1 md:grid-cols-12 gap-10 md:gap-16">
                                <div className="md:col-span-6 space-y-6">
                                    <div className="flex items-center gap-4">
                                        <img src={logoPath} className="w-10 h-10 md:w-12 md:h-12 rounded-xl object-cover" />
                                        <span className="text-2xl md:text-3xl font-black tracking-tighter">بازاریو</span>
                                    </div>
                                    <p className="text-slate-400 text-sm md:text-lg leading-relaxed max-w-xl font-medium italic border-r-4 border-blue-600 pr-6">
                                        بازاریو اولین پلتفرم مدیریت هوشمند تأمین در ایران است که با تمرکز بر سرعت جابجایی کالا، خواب سرمایه در انبار را حذف می‌کند.
                                    </p>
                                </div>
                                <div className="md:col-span-6 grid grid-cols-2 gap-8">
                                    <div className="space-y-4">
                                        <h4 className="font-black text-blue-400 text-[10px] md:text-xs uppercase tracking-widest border-b border-white/10 pb-2">پلتفرم</h4>
                                        <ul className="space-y-2 text-xs md:text-sm font-bold text-slate-500">
                                            <li><a href="#" className="hover:text-white transition-all">مجله استراتژی</a></li>
                                            <li><a href="#" className="hover:text-white transition-all">ابزارهای هوشمند</a></li>
                                        </ul>
                                    </div>
                                    <div className="space-y-4">
                                        <h4 className="font-black text-emerald-400 text-[10px] md:text-xs uppercase tracking-widest border-b border-white/10 pb-2">ارتباط</h4>
                                        <ul className="space-y-3 text-xs md:text-sm font-bold text-slate-100">
                                            <li className="flex items-center gap-2 justify-end tracking-tighter">0903 671 2820 <Icon name="phone" className="w-3.5 h-3.5 text-emerald-400" /></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-12 pt-8 border-t border-white/5 text-center text-[8px] md:text-[10px] font-black text-slate-600 tracking-[0.4em] uppercase">© 2024 Bazaario | Demand Radar Module</div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>